extends layout

block content
  h1(style='margin-top: 100px;') #{translation.CREATESTORY}

  if errors 
    br
    ul
      for error in errors
        li(style='font-size: 1.2em; font-weight: bold; color: red;')!= error.msg
  
  form(method='POST' action='' id='storyForm' name='storyForm')
    div.form-group.row
      div.col-sm-4
        span( style='width: 60px; float:left; margin-top:7px;') #{translation.Book}
        select#book.form-control(type='select', placeholder='Select book' name='book' style='width:400px;float:left;margin-left:20px;' )
          if !story
            option(value='') #{translation.storyonly}
          else
            if !story.book
              option(value='' selected='selected') #{translation.storyonly}
          for book in books
            if story
              if story.book
                option(value=book._id selected=(book._id.toString()==story.book._id.toString() ? 'selected' : false) ) #{book.title}
              else
                if bok
                  option(value=book._id selected=(book._id.toString()==bok.toString() ? 'selected' : false) ) #{book.title}
                else
                  option(value=book._id) #{book.title}
            else
              if bok
                option(value=book._id selected=(book._id.toString()==bok.toString() ? 'selected' : false) ) #{book.title}
              else
                option(value=book._id) #{book.title}
    div.form-group.row
      div.col-sm-8
        span( style='width: 60px; float:left; margin-top:7px;') #{translation.Title}
        input#title.form-control(type='text', style='display: inline; float: left; width: 400px; margin-left: 20px; margin-right: 10px', placeholder='Name of story' name='title' required='true' value=(undefined===story ? '' : story.title) )
        if story
          if story.title_font
            input#title_font.form-control(type='hidden', name='title_font', value=story.title_font)
          else
            input#title_font.form-control(type='hidden', name='title_font')
        else
          input#title_font.form-control(type='hidden', name='title_font')
        div.dropdown(style='display: inline; float: left; width: 150px; margin-left: 20px; margin-right: 10px')
          a#tfnt.dropdown-toggle(href='#' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false') #{translation.FONT}
          div.dropdown-menu(aria-labelledby='tfnt')
            a.dropdown-item(href='#', onclick='toggleSurface("Libre Franklin","LibreFranklin");' )
              span(data-label='Libre Franklin' )
            a.dropdown-item(href='#', onclick='toggleSurface("Inconsolata","inconsolata");' )
              span(data-label='Inconsolata' )
            a.dropdown-item(href='#', onclick='toggleSurface("Roboto","roboto");' )
              span(data-label='Roboto' )
            a.dropdown-item(href='#', onclick='toggleSurface("Mirza","mirza");' )
              span(data-label='Mirza' )
            a.dropdown-item(href='#', onclick='toggleSurface("Arial","arial");' )
              span(data-label='Arial' )
            a.dropdown-item(href='#', onclick='toggleSurface("Oswald","Oswald");' )
              span(data-label='Oswald' )
            a.dropdown-item(href='#', onclick='toggleSurface("Caveat","Caveat");' )
              span(data-label='Caveat' )
            a.dropdown-item(href='#', onclick='toggleSurface("Raleway","Raleway");' )
              span(data-label='Raleway' )
            a.dropdown-item(href='#', onclick='toggleSurface("Shadows Into Light","ShadowsIntoLight");' )
              span(data-label='Shadows Into Light' )
            a.dropdown-item(href='#', onclick='toggleSurface("Abril Fatface","AbrilFatface");' )
              span(data-label='Abril Fatface' )
            a.dropdown-item(href='#', onclick='toggleSurface("Teko","Teko");' )
              span(data-label='Teko' )
            a.dropdown-item(href='#', onclick='toggleSurface("Cormorant","Cormorant");' )
              span(data-label='Cormorant' )
            a.dropdown-item(href='#', onclick='toggleSurface("Alfa Slab One","AlfaSlabOne");' )
              span(data-label='Alfa Slab One' )
            a.dropdown-item(href='#', onclick='toggleSurface("PT Sans","PTSans");' )
              span(data-label='PT Sans' )
            a.dropdown-item(href='#', onclick='toggleSurface("나눔 손글씨 펜","NanumPenScript");' )
              span(data-label='나눔 손글씨 펜' )
            a.dropdown-item(href='#', onclick='toggleSurface("나눔 손글씨 붓","NanumBrushScript");' )
              span(data-label='나눔 손글씨 붓' )
            a.dropdown-item(href='#', onclick='toggleSurface("송명","SongMyung");' )
              span(data-label='송명' )
            a.dropdown-item(href='#', onclick='toggleSurface("개구쟁이","Gaegu");' )
              span(data-label='개구쟁이' )
            a.dropdown-item(href='#', onclick='toggleSurface("주아","Jua");' )
              span(data-label='주아' )
            a.dropdown-item(href='#', onclick='toggleSurface("감자꽃 마을","GamjaFlower");' )
              span(data-label='감자꽃 마을' )
            a.dropdown-item(href='#', onclick='toggleSurface("귀여운 폰트","CuteFont");' )
              span(data-label='귀여운 폰트' )
            a.dropdown-item(href='#', onclick='toggleSurface("스타일리시","Stylish");' )
              span(data-label='스타일리시' )
            a.dropdown-item(href='#', onclick='toggleSurface("연성","YeonSung");' )
              span(data-label='연성' )
            a.dropdown-item(href='#', onclick='toggleSurface("하이멜로디","HiMelody");' )
              span(data-label='하이멜로디' )
            a.dropdown-item(href='#', onclick='toggleSurface("해바라기","Sunflower");' )
              span(data-label='해바라기' )
            a.dropdown-item(href='#', onclick='toggleSurface("검은고딕","BlackHanSans");' )
              span(data-label='검은고딕' )
            a.dropdown-item(href='#', onclick='toggleSurface("고딕 A1","GothicA1");' )
              span(data-label='고딕 A1' )
            a.dropdown-item(href='#', onclick='toggleSurface("나눔고딕","NanumGothic");' )
              span(data-label='나눔고딕' )
            a.dropdown-item(href='#', onclick='toggleSurface("나눔명조","NanumMyeongjo");' )
              span(data-label='나눔명조' )
            a.dropdown-item(href='#', onclick='toggleSurface("서툰이야기","PoorStory");' )
              span(data-label='서툰이야기' )
            a.dropdown-item(href='#', onclick='toggleSurface("흑백사진","BlackAndWhitePicture");' )
              span(data-label='흑백사진' )
        if story
          if story.title_size
            input#title_size.form-control(type='hidden', name='title_size', value=story.title_size)
          else
            input#title_size.form-control(type='hidden', name='title_size')
        else
          input#title_size.form-control(type='hidden', name='title_size')
        div.dropdown(style='display: inline; float: left; width: 150px; margin-left: 20px; margin-right: 10px')
          a#sfnt.dropdown-toggle(href='#' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false') #{translation.SIZE}
          div.dropdown-menu(aria-labelledby='sfnt')
            a.dropdown-item(href='#', onclick='toggleSurface2("1em");' )
              span(data-label='1em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("1.5em");' )
              span(data-label='1.5em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("2em");' )
              span(data-label='2em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("2.5em");' )
              span(data-label='2.5em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("3em");' )
              span(data-label='3em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("3.5em");' )
              span(data-label='3.5em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("4em");' )
              span(data-label='4em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("6em");' )
              span(data-label='6em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("8em");' )
              span(data-label='8em' )
            a.dropdown-item(href='#', onclick='toggleSurface2("10em");' )
              span(data-label='10em' )
    
    div.form-group.row.boko
      div.col-sm-2
        span( style='width: 60px; float:left; margin-top:7px;') #{translation.Order}
        input#order.form-control(type='text', placeholder='Order of story' name='order' value=(undefined===story ? '' : story.order) style='width:100px;float:left;margin-left:20px;' )

    div.form-group.row.boko
      div.col-sm-2
        span( style='width: 60px; float:left; margin-top:7px;') #{translation.Chapter}
        input#chapter.form-control(type='text', placeholder='Chapter of story' name='chapter' value=(undefined===story ? '' : story.chapter) style='width:150px;float:left;margin-left:20px;' )
    
    div.form-group.row.stro
      div.col-sm-2
        span( style='width: 60px; float:left; margin-top:7px;') #{translation.Author}
        input#author.form-control(type='text', placeholder='Author of story' name='author' value=(undefined===story ? '' : story.author) style='width:150px;float:left;margin-left:20px;' )

    div.form-group.row.stro
      div.col-sm-3
        span( style='width: 60px; float:left; margin-top:7px;') #{translation.Reference}
        input#reference.form-control(type='text', placeholder='Reference of story' name='reference' value=(undefined===story ? '' : story.reference) style='width:200px;float:left;margin-left:20px;' )
    
    div.form-group.stro
      span( style='width: 60px; float:left; margin-top:2px;') #{translation.Genre}
      div
        for genre in genres
          div(style='display: inline; padding-right:10px;')
            input.checkbox-input(type='checkbox', class='gne', name='genre', id=genre._id, value=genre._id, checked=genre.checked )
            label(for=genre._id) #{genre.name}
    
    div.form-group.row
      div.col-sm-8
        label(for='Content') #{translation.Content}
        <div id="toolbar-container" class="ql-toolbar ql-snow">
            <span class="ql-formats">
                <select class="ql-font" style="width: 150px;">
                    <option selected="">Sans Serif</option>
                    <option value="LibreFranklin">Libre Franklin</option>
                    <option value="inconsolata">Inconsolata</option>
                    <option value="roboto">Roboto</option>
                    <option value="mirza">Mirza</option>
                    <option value="arial">Arial</option>
                    <option value="Oswald">Oswald</option>
                    <option value="Caveat">Caveat</option>
                    <option value="Raleway">Raleway</option>
                    <option value="ShadowsIntoLight">Shadows Into Light</option>
                    <option value="AbrilFatface">Abril Fatface</option>
                    <option value="Teko">Teko</option>
                    <option value="Cormorant">Cormorant</option>
                    <option value="AlfaSlabOne">Alfa Slab One</option>
                    <option value="PTSans">PT Sans</option>
                    <option value="NanumPenScript">나눔 손글씨 펜</option>
                    <option value="NanumBrushScript">나눔 손글씨 붓</option>
                    <option value="SongMyung">송명</option>
                    <option value="Gaegu">개구쟁이</option>
                    <option value="Jua">주아</option>
                    <option value="GamjaFlower">감자꽃 마을</option>
                    <option value="CuteFont">귀여운 폰트</option>
                    <option value="Stylish">스타일리시</option>
                    <option value="YeonSung">연성</option>
                    <option value="HiMelody">하이멜로디</option>
                    <option value="Sunflower">해바라기</option>
                    <option value="BlackHanSans">검은고딕</option>
                    <option value="GothicA1">고딕 A1</option>
                    <option value="NanumGothic">나눔고딕</option>
                    <option value="NanumMyeongjo">나눔명조</option>
                    <option value="PoorStory">서툰이야기</option>
                    <option value="BlackAndWhitePicture">흑백사진</option>
                </select>
            </span>
            <span class="ql-formats">
                <select class="ql-header"></select>
                <select class="ql-size">
                    <option value="1em">1em</option>
                    <option value="1.5em">1.5em</option>
                    <option value="2em">2em</option>
                    <option value="2.5em">2.5em</option>
                    <option value="3em">3em</option>
                    <option value="3.5em">3.5em</option>
                    <option value="4em">4em</option>
                    <option value="6em">6em</option>
                    <option value="8em">8em</option>
                    <option value="10em">10em</option>
                </select>
            </span>
            <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
                <button class="ql-strike"></button>
            </span>
            <span class="ql-formats">
                <select class="ql-color"></select>
                <select class="ql-background"></select>
            </span>
            <span class="ql-formats">
                <button class="ql-script" value="sub"></button>
                <button class="ql-script" value="super"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-blockquote"></button>
                <button class="ql-code-block"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-list" value="ordered"></button>
                <button class="ql-list" value="bullet"></button>
                <select class="ql-align"></select>
            </span>
            <span class="ql-formats">
                <button class="ql-link"></button>
                <button class="ql-image"></button>
                <button class="ql-video"></button>
                <button class="ql-formula"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-indent" value="-1"></button>
                <button class="ql-indent" value="+1"></button>
                <button class="ql-direction" value="rtl"></button>
                <button class="ql-clean"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-omega"></button>
            </span>
        </div>        
        div#snow-container(spellcheck='false' style='height: 900px;')
        input#content.form-control(type='hidden', name='content' value=(undefined===story ? '' : story.content) )

    div.form-group.row.stro
      div.col-sm-1
        label(for='open') #{translation.Open}:
        select#open.form-control(type='select', placeholder='Select Open' name='open')
          option(value='N' selected=(undefined===story ? 'selected' : story.open=='N' ? 'selected' : false) ) N
          option(value='Y' selected=(undefined===story ? false : story.open=='Y' ? 'selected' : false) ) Y
        <br><br>
    button.btn.btn-primary(type='button', onclick='preview();return false;' style='margin-top: 20px;') #{translation.Preview}
    <br><br>
    button.btn.btn-primary(type='button', onclick='storyPost();return false;') #{translation.Submit}
    <input type="hidden" id="hostname" name="hostname" value="#{hostname}" />
    <input type="hidden" id="btitle" name="btitle" value="" />
    <input type="hidden" id="cptr" name="cptr" value="#{translation.Copy}" />
    <input type="hidden" id="Uploaded" name="Uploaded" value="#{translation.Uploaded}" />
    <input type="hidden" id="UploadFailed" name="UploadFailed" value="#{translation.UploadFailed}" />
    <input type="hidden" id="Delete" name="Delete" value="#{translation.Delete}" />
    <input type="hidden" id="DELETED" name="DELETED" value="#{translation.DELETED}" />
    input#story_id.form-control(type='hidden', name='story_id' value=(undefined===story ? '' : story._id) )
  if story
    if files
      table(class='table table-striped table-bordered table-hover table-condensed' style='margin-top: 20px;')
        tbody.ftd
          for file in files
            tr
              td
                <span id="#{file._id}">#{file.file_name}</span>
                <button class="btn btn-primary" onclick="CopyFilePath('#{file._id}');return false;">#{translation.Copy}</button>
                <button class="btn btn-primary" onclick="DeleteFile('#{file._id}','#{file.file_path}');return false;">#{translation.Delete}</button>
    <div style="display: inline-block; float: left; height: 25px; margin-top: 10px; margin-bottom: 30px;">
      form#fileUpload(method="POST", enctype="multipart/form-data")
        <label for="file_upload" style="line-height: 25px; float: left;text-indent: 0;width: auto;" class="btn btn-primary" title="#{translation.FileDesc}">#{translation.FileSelect}</label>
        <input type="file" name="file_upload" id="file_upload" class="inputfile">
        input(type='hidden' name='storyId' value=story._id)
        button.btn.btn-primary(type='submit' style="line-height: 25px; float: left; margin-left: 20px;") #{translation.FileUpload}

  <a href="#" id="OpenModal" data-toggle="modal" data-target="#exampleModal"></a>

  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">#{translation.Tooltip}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="recipient-name" class="col-form-label">#{translation.ImageAddress}:</label>
              <input type="text" class="form-control" id="recipient-name">
            </div>
            <div class="form-group">
              <label for="message-text" class="col-form-label">#{translation.Definition}:</label>
              <textarea class="form-control" id="message-text"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" id="tcls">#{translation.Close}</button>
          <button type="button" class="btn btn-primary" id="InsertTooltip">#{translation.InsertTooltip}</button>
        </div>
      </div>
    </div>
  </div>
  
  <a href="#" id="OpenVideo" data-toggle="modal" data-target="#videoModal"></a>

  <div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="videoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="videoModalLabel">Youtube</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="video_src" class="col-form-label">URL:</label>
              <input type="text" class="form-control" id="video_src">
            </div>
            <div class="form-group">
              <label for="video_width" class="col-form-label">Width:</label>
              <input type="text" class="form-control" id="video_width">
            </div>
            <div class="form-group">
              <label for="video_height" class="col-form-label">Height:</label>
              <input type="text" class="form-control" id="video_height">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" id="vcls">#{translation.Close}</button>
          <button type="button" class="btn btn-primary" id="InsertVideo">Insert Youtube</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="overlay"></div>
  <div class="spanner">
    <div class="loader"></div>
    <p>#{translation.UploadingFile}</p>
  </div>

  div(style='margin-bottom: 50px;')

  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script src="/js/quill_setting.js"></script>
  <script src="/js/storyUpdate.js"></script>
